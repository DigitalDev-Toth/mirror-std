var measuring={ruler:function(){var d=this;handler.regInfo=new Array();if(!handler.mobileEnvironment.isMobile()){var e=document.createElement("canvas");var a=e.getContext("2d");e.setAttribute("id","mRuler");document.getElementById("scene").appendChild(e);e.width=$("#myCanvas").width();e.height=$("#myCanvas").height();e.style.zIndex=10;e.style.position="absolute";e.style.left=0;e.style.top=0;var b=false;$("#mRuler").on("click",function(c){handler.rClicks++;if(handler.rClicks===1){handler.bx=c.clientX-$(this).offset().left;handler.by=c.clientY-$(this).offset().top;if(handler.regInfo.length>0){while(!b&&handler.regCount<handler.regInfo.length){if(((handler.regInfo[handler.regCount].bx-5)<handler.bx)&&((handler.regInfo[handler.regCount].bx+5)>handler.bx)&&((handler.regInfo[handler.regCount].by-5)<handler.by)&&((handler.regInfo[handler.regCount].by+5)>handler.by)){b=true;handler.bx=handler.regInfo[handler.regCount].fx;handler.by=handler.regInfo[handler.regCount].fy;handler.cRuler=handler.regInfo[handler.regCount].cRuler;handler.regInfo.splice(handler.regCount,1)}else{if(((handler.regInfo[handler.regCount].fx-5)<handler.bx)&&((handler.regInfo[handler.regCount].fx+5)>handler.bx)&&((handler.regInfo[handler.regCount].fy-5)<handler.by)&&((handler.regInfo[handler.regCount].fy+5)>handler.by)){b=true;handler.bx=handler.regInfo[handler.regCount].bx;handler.by=handler.regInfo[handler.regCount].by;handler.cRuler=handler.regInfo[handler.regCount].cRuler;handler.regInfo.splice(handler.regCount,1)}}if(!b){handler.regCount++}}}if(!b){handler.regCount=0;a.beginPath();a.arc(handler.bx,handler.by,3,0,Math.PI*2,true);a.fillStyle="#d58512";a.fill();a.closePath()}$(this).on("mousemove",function(j){handler.regCount=0;a.clearRect(0,0,e.width,e.height);$("#scene h5").remove();if(handler.regInfo.length>0){d.paintRegRuler(e,a)}handler.fx=j.clientX-$(this).offset().left;handler.fy=j.clientY-$(this).offset().top;var g=(handler.bx-handler.fx)*handler.pixelSpacing[0];var f=(handler.by-handler.fy)*handler.pixelSpacing[1];var h=(g*g)+(f*f);handler.rm=Math.sqrt(h)/handler.infoScale;var i=(handler.fy-handler.by)/(handler.fx-handler.bx);if(i>0){$("#scene").append('<h5><span style="z-index: 20; color: #fff; background-color: rgba(0, 0, 0, 0.5); border-radius: 3px; border: 1px solid ##505050; position: absolute; top: '+(((handler.fy+handler.by)/2)-20).toFixed(0)+"px; left: "+(((handler.fx+handler.bx)/2).toFixed(0))+'px;">'+handler.rm.toFixed(0)+"[mm]</span></h5>")}else{$("#scene").append('<h5><span style="z-index: 20; color: #fff; background-color: rgba(0, 0, 0, 0.5); border-radius: 3px; border: 1px solid ##505050; position: absolute; top: '+(((handler.fy+handler.by)/2)+5).toFixed(0)+"px; left: "+(((handler.fx+handler.bx)/2).toFixed(0))+'px;">'+handler.rm.toFixed(0)+"[mm]</span></h5>")}a.beginPath();a.moveTo(handler.fx,handler.fy);a.lineTo(handler.bx,handler.by);a.lineWidth=2;a.strokeStyle="#d58512";a.stroke();a.closePath();a.beginPath();a.arc(handler.bx,handler.by,3,0,Math.PI*2,true);a.fillStyle="#d58512";a.fill();a.closePath();if(b){a.beginPath();a.arc(handler.fx,handler.fy,3,0,Math.PI*2,true);a.fillStyle="#d58512";a.fill();a.closePath()}})}else{if(handler.rClicks===2){$("#mRuler").unbind("mousemove");if(!b){a.beginPath();a.arc(handler.fx,handler.fy,3,0,Math.PI*2,true);a.fillStyle="#d58512";a.fill();a.closePath()}handler.infoData={bx:handler.bx,by:handler.by,fx:handler.fx,fy:handler.fy,cRuler:handler.rm};handler.regInfo.push(handler.infoData);handler.rClicks=0;handler.regCount=0;b=false}}})}else{var e=document.createElement("canvas");var a=e.getContext("2d");e.setAttribute("id","mRulerMobile");document.getElementById("scene").appendChild(e);e.width=$("#myCanvas").width();e.height=$("#myCanvas").height();e.style.zIndex=10;e.style.position="absolute";e.style.left=0;e.style.top=0;var b=0;$("#mRulerMobile").bind("touchstart",function(c){handler.bx=c.originalEvent.touches[0].pageX-$(this).offset().left;handler.by=c.originalEvent.touches[0].pageY-$(this).offset().top;if(handler.regInfo.length>0){while(!b&&handler.regCount<handler.regInfo.length){if(((handler.regInfo[handler.regCount].bx-13)<handler.bx)&&((handler.regInfo[handler.regCount].bx+13)>handler.bx)&&((handler.regInfo[handler.regCount].by-13)<handler.by)&&((handler.regInfo[handler.regCount].by+13)>handler.by)){b=true;handler.bx=handler.regInfo[handler.regCount].fx;handler.by=handler.regInfo[handler.regCount].fy;handler.cRuler=handler.regInfo[handler.regCount].cRuler;handler.regInfo.splice(handler.regCount,1)}else{if(((handler.regInfo[handler.regCount].fx-13)<handler.bx)&&((handler.regInfo[handler.regCount].fx+13)>handler.bx)&&((handler.regInfo[handler.regCount].fy-13)<handler.by)&&((handler.regInfo[handler.regCount].fy+13)>handler.by)){b=true;handler.bx=handler.regInfo[handler.regCount].bx;handler.by=handler.regInfo[handler.regCount].by;handler.cRuler=handler.regInfo[handler.regCount].cRuler;handler.regInfo.splice(handler.regCount,1)}}if(!b){handler.regCount++}}}if(!b){a.beginPath();a.arc(handler.bx,handler.by,3,0,Math.PI*2,true);a.fillStyle="#d58512";a.fill();a.closePath()}$(this).bind("touchmove",function(j){a.clearRect(0,0,e.width,e.height);$("#scene h5").remove();if(handler.regInfo.length>0){d.paintRegRuler(e,a)}handler.fx=j.originalEvent.touches[0].pageX-$(this).offset().left-30;handler.fy=j.originalEvent.touches[0].pageY-$(this).offset().top-30;var g=(handler.bx-handler.fx)*handler.pixelSpacing[0];var f=(handler.by-handler.fy)*handler.pixelSpacing[1];var h=(g*g)+(f*f);handler.rm=Math.sqrt(h)/handler.infoScale;var i=(handler.fy-handler.by)/(handler.fx-handler.bx);if(i>0){$("#scene").append('<h5><span style="z-index: 20; color: #fff; background-color: rgba(0, 0, 0, 0.5); border-radius: 3px; border: 1px solid ##505050; position: absolute; top: '+(((handler.fy+handler.by)/2)-20).toFixed(0)+"px; left: "+(((handler.fx+handler.bx)/2).toFixed(0))+'px;">'+handler.rm.toFixed(0)+"[mm]</span></h5>")}else{$("#scene").append('<h5><span style="z-index: 20; color: #fff; background-color: rgba(0, 0, 0, 0.5); border-radius: 3px; border: 1px solid ##505050; position: absolute; top: '+(((handler.fy+handler.by)/2)+5).toFixed(0)+"px; left: "+(((handler.fx+handler.bx)/2).toFixed(0))+'px;">'+handler.rm.toFixed(0)+"[mm]</span></h5>")}a.beginPath();a.moveTo(handler.fx,handler.fy);a.lineTo(handler.bx,handler.by);a.lineWidth=2;a.strokeStyle="#d58512";a.stroke();a.closePath();a.beginPath();a.arc(handler.bx,handler.by,3,0,Math.PI*2,true);a.fillStyle="#d58512";a.fill();a.closePath();if(b){a.beginPath();a.arc(handler.fx,handler.fy,3,0,Math.PI*2,true);a.fillStyle="#d58512";a.fill();a.closePath()}})});$("#mRulerMobile").bind("touchend",function(c){$(this).unbind("touchmove");if(!b){a.beginPath();a.arc(handler.fx,handler.fy,3,0,Math.PI*2,true);a.fillStyle="#d58512";a.fill();a.closePath()}handler.infoData={bx:handler.bx,by:handler.by,fx:handler.fx,fy:handler.fy,cRuler:handler.rm};handler.regInfo.push(handler.infoData);b=false;handler.regCount=0})}},paintRegRuler:function(e,a){for(var b=0;b<handler.regInfo.length;b++){var d=(handler.regInfo[b].fy-handler.regInfo[b].by)/(handler.regInfo[b].fx-handler.regInfo[b].bx);if(d>0){$("#scene").append('<h5><span style="z-index: 20; color: #fff; background-color: rgba(0, 0, 0, 0.5); border-radius: 3px; border: 1px solid ##505050; position: absolute; top: '+(((handler.regInfo[b].fy+handler.regInfo[b].by)/2)-20).toFixed(0)+"px; left: "+(((handler.regInfo[b].fx+handler.regInfo[b].bx)/2).toFixed(0))+'px;">'+handler.regInfo[b].cRuler.toFixed(0)+"[mm]</span></h5>")}else{$("#scene").append('<h5><span style="z-index: 20; color: #fff; background-color: rgba(0, 0, 0, 0.5); border-radius: 3px; border: 1px solid ##505050; position: absolute; top: '+(((handler.regInfo[b].fy+handler.regInfo[b].by)/2)+5).toFixed(0)+"px; left: "+(((handler.regInfo[b].fx+handler.regInfo[b].bx)/2).toFixed(0))+'px;">'+handler.regInfo[b].cRuler.toFixed(0)+"[mm]</span></h5>")}a.beginPath();a.moveTo(handler.regInfo[b].fx,handler.regInfo[b].fy);a.lineTo(handler.regInfo[b].bx,handler.regInfo[b].by);a.lineWidth=2;a.strokeStyle="#d58512";a.stroke();a.closePath();a.beginPath();a.arc(handler.regInfo[b].bx,handler.regInfo[b].by,3,0,Math.PI*2,true);a.fillStyle="#d58512";a.fill();a.closePath();a.beginPath();a.arc(handler.regInfo[b].fx,handler.regInfo[b].fy,3,0,Math.PI*2,true);a.fillStyle="#d58512";a.fill();a.closePath()}},angle:function(){var e=this;handler.regInfo=new Array();if(!handler.mobileEnvironment.isMobile()){var f=document.createElement("canvas");var b=f.getContext("2d");f.setAttribute("id","mAngle");document.getElementById("scene").appendChild(f);f.width=$("#myCanvas").width();f.height=$("#myCanvas").height();f.style.zIndex=10;f.style.position="absolute";f.style.left=0;f.style.top=0;var d=false;var a=0;$("#mAngle").on("click",function(c){handler.rClicks++;if(handler.rClicks===1){handler.fx=c.clientX-$(this).offset().left;handler.fy=c.clientY-$(this).offset().top;if(handler.regInfo.length>0){while(!d&&handler.regCount<handler.regInfo.length){if(((handler.regInfo[handler.regCount].fx-5)<handler.fx)&&((handler.regInfo[handler.regCount].fx+5)>handler.fx)&&((handler.regInfo[handler.regCount].fy-5)<handler.fy)&&((handler.regInfo[handler.regCount].fy+5)>handler.fy)){d=true;a=0;handler.sx=handler.regInfo[handler.regCount].sx;handler.sy=handler.regInfo[handler.regCount].sy;handler.tx=handler.regInfo[handler.regCount].tx;handler.ty=handler.regInfo[handler.regCount].ty;handler.cAngle=handler.regInfo[handler.regCount].cAngle;handler.regInfo.splice(handler.regCount,1)}else{if(((handler.regInfo[handler.regCount].sx-5)<handler.fx)&&((handler.regInfo[handler.regCount].sx+5)>handler.fx)&&((handler.regInfo[handler.regCount].sy-5)<handler.fy)&&((handler.regInfo[handler.regCount].sy+5)>handler.fy)){d=true;a=1;handler.fx=handler.regInfo[handler.regCount].fx;handler.fy=handler.regInfo[handler.regCount].fy;handler.tx=handler.regInfo[handler.regCount].tx;handler.ty=handler.regInfo[handler.regCount].ty;handler.cAngle=handler.regInfo[handler.regCount].cAngle;handler.regInfo.splice(handler.regCount,1)}else{if(((handler.regInfo[handler.regCount].tx-5)<handler.fx)&&((handler.regInfo[handler.regCount].tx+5)>handler.fx)&&((handler.regInfo[handler.regCount].ty-5)<handler.fy)&&((handler.regInfo[handler.regCount].ty+5)>handler.fy)){d=true;a=2;handler.fx=handler.regInfo[handler.regCount].fx;handler.fy=handler.regInfo[handler.regCount].fy;handler.sx=handler.regInfo[handler.regCount].sx;handler.sy=handler.regInfo[handler.regCount].sy;handler.cAngle=handler.regInfo[handler.regCount].cAngle;handler.regInfo.splice(handler.regCount,1)}}}if(!d){handler.regCount++}}}if(!d){handler.regCount=0;b.beginPath();b.arc(handler.fx,handler.fy,3,0,Math.PI*2,true);b.fillStyle="#d58512";b.fill();b.closePath();$(this).on("mousemove",function(g){b.clearRect(0,0,$("#myCanvas").width(),$("#myCanvas").height());$("#scene h5").remove();if(handler.regInfo.length>0){e.paintRegAngle(f,b)}handler.sx=g.clientX-$(this).offset().left;handler.sy=g.clientY-$(this).offset().top;b.beginPath();b.moveTo(handler.sx,handler.sy);b.lineTo(handler.fx,handler.fy);b.lineWidth=2;b.strokeStyle="#d58512";b.stroke();b.beginPath();b.arc(handler.fx,handler.fy,3,0,Math.PI*2,true);b.fillStyle="#d58512";b.fill();b.closePath()})}else{$(this).on("mousemove",function(l){b.clearRect(0,0,$("#myCanvas").width(),$("#myCanvas").height());$("#scene h5").remove();if(handler.regInfo.length>0){e.paintRegAngle(n,b)}if(a===0){handler.fx=l.clientX-$(this).offset().left;handler.fy=l.clientY-$(this).offset().top}else{if(a===1){handler.sx=l.clientX-$(this).offset().left;handler.sy=l.clientY-$(this).offset().top}else{if(a===2){handler.tx=l.clientX-$(this).offset().left;handler.ty=l.clientY-$(this).offset().top}}}var i=((handler.fx-handler.tx)*(handler.fx-handler.tx))+((handler.fy-handler.ty)*(handler.fy-handler.ty));var n=Math.sqrt(i);var k=((handler.sx-handler.tx)*(handler.sx-handler.tx))+((handler.sy-handler.ty)*(handler.sy-handler.ty));var g=Math.sqrt(k);var m=((handler.fx-handler.sx)*(handler.fx-handler.sx))+((handler.fy-handler.sy)*(handler.fy-handler.sy));var h=Math.sqrt(m);var j=Math.acos(((h*h)+(g*g)-(n*n))/(2*h*g));handler.rm=j*(180/Math.PI);$("#scene").append('<h5><span style="z-index: 20; color: #fff; background-color: rgba(0, 0, 0, 0.5); border-radius: 3px; border: 1px solid ##505050; position: absolute; top: '+(handler.sy+5)+"px; left: "+(handler.sx+5)+'px;">'+handler.rm.toFixed(2)+"º</span></h5>");b.beginPath();b.moveTo(handler.sx,handler.sy);b.lineTo(handler.fx,handler.fy);b.lineWidth=2;b.strokeStyle="#d58512";b.stroke();b.beginPath();b.arc(handler.fx,handler.fy,2,0,Math.PI*2,true);b.fillStyle="#d58512";b.fill();b.closePath();b.moveTo(handler.sx,handler.sy);b.lineTo(handler.tx,handler.ty);b.lineWidth=2;b.strokeStyle="#d58512";b.stroke();b.beginPath();b.arc(handler.sx,handler.sy,3,0,Math.PI*2,true);b.fillStyle="#d58512";b.fill();b.closePath();b.beginPath();b.arc(handler.tx,handler.ty,3,0,Math.PI*2,true);b.fillStyle="#d58512";b.fill();b.closePath()})}}else{if(handler.rClicks===2){if(!d){$(this).unbind("mousemove");handler.sx=c.clientX-$(this).offset().left;handler.sy=c.clientY-$(this).offset().top;b.beginPath();b.arc(handler.sx,handler.sy,3,0,Math.PI*2,true);b.fillStyle="#d58512";b.fill();b.closePath();$(this).on("mousemove",function(l){b.clearRect(0,0,$("#myCanvas").width(),$("#myCanvas").height());$("#scene h5").remove();if(handler.regInfo.length>0){e.paintRegAngle(n,b)}handler.tx=l.clientX-$(this).offset().left;handler.ty=l.clientY-$(this).offset().top;var i=((handler.fx-handler.tx)*(handler.fx-handler.tx))+((handler.fy-handler.ty)*(handler.fy-handler.ty));var n=Math.sqrt(i);var k=((handler.sx-handler.tx)*(handler.sx-handler.tx))+((handler.sy-handler.ty)*(handler.sy-handler.ty));var g=Math.sqrt(k);var m=((handler.fx-handler.sx)*(handler.fx-handler.sx))+((handler.fy-handler.sy)*(handler.fy-handler.sy));var h=Math.sqrt(m);var j=Math.acos(((h*h)+(g*g)-(n*n))/(2*h*g));handler.rm=j*(180/Math.PI);$("#scene").append('<h5><span style="z-index: 20; color: #fff; background-color: rgba(0, 0, 0, 0.5); border-radius: 3px; border: 1px solid ##505050; position: absolute; top: '+(handler.sy+5)+"px; left: "+(handler.sx+5)+'px;">'+handler.rm.toFixed(2)+"º</span></h5>");b.beginPath();b.moveTo(handler.sx,handler.sy);b.lineTo(handler.fx,handler.fy);b.lineWidth=2;b.strokeStyle="#d58512";b.stroke();b.beginPath();b.arc(handler.fx,handler.fy,2,0,Math.PI*2,true);b.fillStyle="#d58512";b.fill();b.closePath();b.moveTo(handler.sx,handler.sy);b.lineTo(handler.tx,handler.ty);b.lineWidth=2;b.strokeStyle="#d58512";b.stroke();b.beginPath();b.arc(handler.sx,handler.sy,3,0,Math.PI*2,true);b.fillStyle="#d58512";b.fill();b.closePath()})}else{$(this).unbind("mousemove");handler.infoData={fx:handler.fx,fy:handler.fy,sx:handler.sx,sy:handler.sy,tx:handler.tx,ty:handler.ty,cAngle:handler.rm};handler.regInfo.push(handler.infoData);handler.rClicks=0;d=false;handler.regCount=0}}else{if(handler.rClicks===3){if(!d){$(this).unbind("mousemove");b.beginPath();b.arc(handler.tx,handler.ty,3,0,Math.PI*2,true);b.fillStyle="#d58512";b.fill();b.closePath();handler.infoData={fx:handler.fx,fy:handler.fy,sx:handler.sx,sy:handler.sy,tx:handler.tx,ty:handler.ty,cAngle:handler.rm};handler.regInfo.push(handler.infoData);handler.rClicks=0;d=false;handler.regCount=0}}}}})}else{var f=document.createElement("canvas");var b=f.getContext("2d");f.setAttribute("id","mAngleMobile");document.getElementById("scene").appendChild(f);f.width=$("#myCanvas").width();f.height=$("#myCanvas").height();f.style.zIndex=10;f.style.position="absolute";f.style.left=0;f.style.top=0;var d=false;var a=0;$("#mAngleMobile").bind("touchstart",function(c){handler.rClicks++;if(handler.rClicks===1){handler.fx=c.originalEvent.touches[0].pageX-$(this).offset().left;handler.fy=c.originalEvent.touches[0].pageY-$(this).offset().top;if(handler.regInfo.length>0){while(!d&&handler.regCount<handler.regInfo.length){if(((handler.regInfo[handler.regCount].fx-13)<handler.fx)&&((handler.regInfo[handler.regCount].fx+13)>handler.fx)&&((handler.regInfo[handler.regCount].fy-13)<handler.fy)&&((handler.regInfo[handler.regCount].fy+13)>handler.fy)){d=true;a=0;handler.sx=handler.regInfo[handler.regCount].sx;handler.sy=handler.regInfo[handler.regCount].sy;handler.tx=handler.regInfo[handler.regCount].tx;handler.ty=handler.regInfo[handler.regCount].ty;handler.cAngle=handler.regInfo[handler.regCount].cAngle;handler.regInfo.splice(handler.regCount,1)}else{if(((handler.regInfo[handler.regCount].sx-13)<handler.fx)&&((handler.regInfo[handler.regCount].sx+13)>handler.fx)&&((handler.regInfo[handler.regCount].sy-13)<handler.fy)&&((handler.regInfo[handler.regCount].sy+13)>handler.fy)){d=true;a=1;handler.fx=handler.regInfo[handler.regCount].fx;handler.fy=handler.regInfo[handler.regCount].fy;handler.tx=handler.regInfo[handler.regCount].tx;handler.ty=handler.regInfo[handler.regCount].ty;handler.cAngle=handler.regInfo[handler.regCount].cAngle;handler.regInfo.splice(handler.regCount,1)}else{if(((handler.regInfo[handler.regCount].tx-13)<handler.fx)&&((handler.regInfo[handler.regCount].tx+13)>handler.fx)&&((handler.regInfo[handler.regCount].ty-13)<handler.fy)&&((handler.regInfo[handler.regCount].ty+13)>handler.fy)){d=true;a=2;handler.fx=handler.regInfo[handler.regCount].fx;handler.fy=handler.regInfo[handler.regCount].fy;handler.sx=handler.regInfo[handler.regCount].sx;handler.sy=handler.regInfo[handler.regCount].sy;handler.cAngle=handler.regInfo[handler.regCount].cAngle;handler.regInfo.splice(handler.regCount,1)}}}if(!d){handler.regCount++}}}if(!d){b.beginPath();b.arc(handler.fx,handler.fy,3,0,Math.PI*2,true);b.fillStyle="#d58512";b.fill();b.closePath();$(this).bind("touchmove",function(g){b.clearRect(0,0,$("#myCanvas").width(),$("#myCanvas").height());$("#scene h5").remove();if(handler.regInfo.length>0){e.paintRegAngle(f,b)}handler.sx=g.originalEvent.touches[0].pageX-$(this).offset().left-30;handler.sy=g.originalEvent.touches[0].pageY-$(this).offset().top-30;b.beginPath();b.moveTo(handler.sx,handler.sy);b.lineTo(handler.fx,handler.fy);b.lineWidth=2;b.strokeStyle="#d58512";b.stroke();b.closePath();b.beginPath();b.arc(handler.fx,handler.fy,3,0,Math.PI*2,true);b.fillStyle="#d58512";b.fill();b.closePath()})}else{$(this).bind("touchmove",function(l){b.clearRect(0,0,$("#myCanvas").width(),$("#myCanvas").height());$("#scene h5").remove();if(handler.regInfo.length>0){e.paintRegAngle(n,b)}if(a===0){handler.fx=l.originalEvent.touches[0].pageX-$(this).offset().left-30;handler.fy=l.originalEvent.touches[0].pageY-$(this).offset().top-30}else{if(a===1){handler.sx=l.originalEvent.touches[0].pageX-$(this).offset().left-30;handler.sy=l.originalEvent.touches[0].pageY-$(this).offset().top-30}else{if(a===2){handler.tx=l.originalEvent.touches[0].pageX-$(this).offset().left-30;handler.ty=l.originalEvent.touches[0].pageY-$(this).offset().top-30}}}var i=((handler.fx-handler.tx)*(handler.fx-handler.tx))+((handler.fy-handler.ty)*(handler.fy-handler.ty));var n=Math.sqrt(i);var k=((handler.sx-handler.tx)*(handler.sx-handler.tx))+((handler.sy-handler.ty)*(handler.sy-handler.ty));var g=Math.sqrt(k);var m=((handler.fx-handler.sx)*(handler.fx-handler.sx))+((handler.fy-handler.sy)*(handler.fy-handler.sy));var h=Math.sqrt(m);var j=Math.acos(((h*h)+(g*g)-(n*n))/(2*h*g));handler.rm=j*(180/Math.PI);$("#scene").append('<h5><span style="z-index: 20; color: #fff; background-color: rgba(0, 0, 0, 0.5); border-radius: 3px; border: 1px solid ##505050; position: absolute; top: '+(handler.sy+5)+"px; left: "+(handler.sx+5)+'px;">'+handler.rm.toFixed(2)+"º</span></h5>");b.beginPath();b.moveTo(handler.sx,handler.sy);b.lineTo(handler.fx,handler.fy);b.lineWidth=2;b.strokeStyle="#d58512";b.stroke();b.closePath();b.beginPath();b.arc(handler.sx,handler.sy,3,0,Math.PI*2,true);b.fillStyle="#d58512";b.fill();b.closePath();b.beginPath();b.arc(handler.fx,handler.fy,3,0,Math.PI*2,true);b.fillStyle="#d58512";b.fill();b.closePath();b.beginPath();b.arc(handler.tx,handler.ty,3,0,Math.PI*2,true);b.fillStyle="#d58512";b.fill();b.closePath();b.beginPath();b.moveTo(handler.sx,handler.sy);b.lineTo(handler.tx,handler.ty);b.lineWidth=2;b.strokeStyle="#d58512";b.stroke();b.closePath()})}}else{if(handler.rClicks===2){$(this).bind("touchmove",function(l){b.clearRect(0,0,$("#myCanvas").width(),$("#myCanvas").height());$("#scene h5").remove();if(handler.regInfo.length>0){e.paintRegAngle(n,b)}handler.tx=l.originalEvent.touches[0].pageX-$(this).offset().left-30;handler.ty=l.originalEvent.touches[0].pageY-$(this).offset().top-30;var i=((handler.fx-handler.tx)*(handler.fx-handler.tx))+((handler.fy-handler.ty)*(handler.fy-handler.ty));var n=Math.sqrt(i);var k=((handler.sx-handler.tx)*(handler.sx-handler.tx))+((handler.sy-handler.ty)*(handler.sy-handler.ty));var g=Math.sqrt(k);var m=((handler.fx-handler.sx)*(handler.fx-handler.sx))+((handler.fy-handler.sy)*(handler.fy-handler.sy));var h=Math.sqrt(m);var j=Math.acos(((h*h)+(g*g)-(n*n))/(2*h*g));handler.rm=j*(180/Math.PI);$("#scene").append('<h5><span style="z-index: 20; color: #fff; background-color: rgba(0, 0, 0, 0.5); border-radius: 3px; border: 1px solid ##505050; position: absolute; top: '+(handler.sy+5)+"px; left: "+(handler.sx+5)+'px;">'+handler.rm.toFixed(2)+"º</span></h5>");b.beginPath();b.moveTo(handler.sx,handler.sy);b.lineTo(handler.fx,handler.fy);b.lineWidth=2;b.strokeStyle="#d58512";b.stroke();b.closePath();b.beginPath();b.arc(handler.sx,handler.sy,3,0,Math.PI*2,true);b.fillStyle="#d58512";b.fill();b.closePath();b.beginPath();b.arc(handler.fx,handler.fy,3,0,Math.PI*2,true);b.fillStyle="#d58512";b.fill();b.closePath();b.beginPath();b.moveTo(handler.sx,handler.sy);b.lineTo(handler.tx,handler.ty);b.lineWidth=2;b.strokeStyle="#d58512";b.stroke();b.closePath()})}}});$("#mAngleMobile").bind("touchend",function(c){$(this).unbind("touchmove");if(!d){if(handler.rClicks===1){b.beginPath();b.arc(handler.sx,handler.sy,3,0,Math.PI*2,true);b.fillStyle="#d58512";b.fill();b.closePath()}else{if(handler.rClicks===2){b.beginPath();b.arc(handler.tx,handler.ty,3,0,Math.PI*2,true);b.fillStyle="#d58512";b.fill();b.closePath();handler.infoData={fx:handler.fx,fy:handler.fy,sx:handler.sx,sy:handler.sy,tx:handler.tx,ty:handler.ty,cAngle:handler.rm};handler.regInfo.push(handler.infoData);handler.rClicks=0;d=false;handler.regCount=0}}}else{handler.infoData={fx:handler.fx,fy:handler.fy,sx:handler.sx,sy:handler.sy,tx:handler.tx,ty:handler.ty,cAngle:handler.rm};handler.regInfo.push(handler.infoData);handler.rClicks=0;d=false;handler.regCount=0}})}},paintRegAngle:function(d,a){for(var b=0;b<handler.regInfo.length;b++){$("#scene").append('<h5><span style="z-index: 20; color: #fff; background-color: rgba(0, 0, 0, 0.5); border-radius: 3px; border: 1px solid ##505050; position: absolute; top: '+(handler.regInfo[b].sy+5)+"px; left: "+(handler.regInfo[b].sx+5)+'px;">'+handler.regInfo[b].cAngle.toFixed(2)+"º</span></h5>");a.beginPath();a.moveTo(handler.regInfo[b].sx,handler.regInfo[b].sy);a.lineTo(handler.regInfo[b].fx,handler.regInfo[b].fy);a.lineWidth=2;a.strokeStyle="#d58512";a.stroke();a.closePath();a.beginPath();a.moveTo(handler.regInfo[b].sx,handler.regInfo[b].sy);a.lineTo(handler.regInfo[b].tx,handler.regInfo[b].ty);a.lineWidth=2;a.strokeStyle="#d58512";a.stroke();a.closePath();a.beginPath();a.arc(handler.regInfo[b].fx,handler.regInfo[b].fy,3,0,Math.PI*2,true);a.fillStyle="#d58512";a.fill();a.closePath();a.beginPath();a.arc(handler.regInfo[b].sx,handler.regInfo[b].sy,3,0,Math.PI*2,true);a.fillStyle="#d58512";a.fill();a.closePath();a.beginPath();a.arc(handler.regInfo[b].tx,handler.regInfo[b].ty,3,0,Math.PI*2,true);a.fillStyle="#d58512";a.fill();a.closePath()}},area:function(){var h=this;handler.regInfo=new Array();if(!handler.mobileEnvironment.isMobile()){var g=document.createElement("canvas");var i=g.getContext("2d");g.setAttribute("id","mArea");document.getElementById("scene").appendChild(g);g.width=$("#myCanvas").width();g.height=$("#myCanvas").height();g.style.zIndex=10;g.style.position="absolute";g.style.left=0;g.style.top=0;var f=false;var b=false;var a=0,j=0,e=0,d=0;handler.aRadius=1;$("#mArea").on("mousedown",function(c){handler.sx=c.offsetX;handler.sy=c.offsetY;e=handler.sx;d=handler.sy;handler.aRadius=1;if(handler.regInfo.length>0){while(!f&&handler.regCount<handler.regInfo.length){if(((handler.regInfo[handler.regCount].sx-handler.regInfo[handler.regCount].radius)<handler.sx)&&((handler.regInfo[handler.regCount].sx+handler.regInfo[handler.regCount].radius)>handler.sx)&&((handler.regInfo[handler.regCount].sy-handler.regInfo[handler.regCount].radius)<handler.sy)&&((handler.regInfo[handler.regCount].sy+handler.regInfo[handler.regCount].radius)>handler.sy)){f=true;handler.sx=handler.regInfo[handler.regCount].sx;handler.sy=handler.regInfo[handler.regCount].sy;handler.rm=handler.regInfo[handler.regCount].cArea;handler.aRadius=handler.regInfo[handler.regCount].radius;handler.regInfo.splice(handler.regCount,1)}if(!f){handler.regCount++}}handler.regCount=0}if(c.which===1){var k=handler.sy;b=true;$("#mArea").on("mousemove",function(n){i.clearRect(0,0,g.width,g.height);$("#scene h5").remove();if(handler.regInfo.length>0){h.paintRegArea(g,i)}var o=n.offsetY;var l=k-o;l<0?handler.aRadius+=2:handler.aRadius-=2;if(handler.aRadius<=0){handler.aRadius=1}var m=Math.PI*(handler.aRadius*handler.aRadius*handler.pixelSpacing[0]*handler.pixelSpacing[1]);handler.rm=m/handler.infoScale;$("#scene").append('<h5><span style="z-index: 20; color: #fff; background-color: rgba(0, 0, 0, 0.5); border-radius: 3px; border: 1px solid ##505050; position: absolute; top: '+(handler.sy+10)+"px; left: "+(handler.sx+10)+'px;">'+handler.rm.toFixed(0)+"[mm&sup2;]</span></h5>");i.beginPath();i.arc(handler.sx,handler.sy,handler.aRadius,0,Math.PI*2,true);i.fillStyle="rgba(213, 133, 18, 0.3)";i.fill();i.lineWidth=2;i.strokeStyle="#d58512";i.stroke();k=o})}else{if(c.which===3&&f){$("#mArea").on("mousemove",function(l){i.clearRect(0,0,g.width,g.height);$("#scene h5").remove();if(handler.regInfo.length>0){h.paintRegArea(g,i)}a=l.offsetX;j=l.offsetY;handler.sx+=(a-e);handler.sy+=(j-d);$("#scene").append('<h5><span style="z-index: 20; color: #fff; background-color: rgba(0, 0, 0, 0.5); border-radius: 3px; border: 1px solid ##505050; position: absolute; top: '+(handler.sy+10)+"px; left: "+(handler.sx+10)+'px;">'+handler.rm.toFixed(0)+"[mm&sup2;]</span></h5>");i.beginPath();i.arc(handler.sx,handler.sy,handler.aRadius,0,Math.PI*2,true);i.fillStyle="rgba(213, 133, 18, 0.3)";i.fill();i.lineWidth=2;i.strokeStyle="#d58512";i.stroke();e=a;d=j})}}});$("#mArea").on("mouseup",function(){$("#mArea").unbind("mousemove");if(f||b){handler.infoData={sx:handler.sx,sy:handler.sy,radius:handler.aRadius,cArea:handler.rm};handler.regInfo.push(handler.infoData);f=false;b=false;handler.regCount=0}})}else{var g=document.createElement("canvas");var i=g.getContext("2d");g.setAttribute("id","mAreaMobile");document.getElementById("scene").appendChild(g);g.width=$("#myCanvas").width();g.height=$("#myCanvas").height();g.style.zIndex=10;g.style.position="absolute";g.style.left=0;g.style.top=0;var f=false;var b=false;var a=0,j=0,e=0,d=0;handler.aRadius=1;$("#mAreaMobile").bind("touchstart",function(c){if(c.originalEvent.touches.length===1){handler.sx=c.originalEvent.touches[0].pageX-$(this).offset().left;handler.sy=c.originalEvent.touches[0].pageY-$(this).offset().top}else{if(c.originalEvent.touches.length===2){handler.sx=((c.originalEvent.touches[0].pageX-$(this).offset().left)+(c.originalEvent.touches[1].pageX-$(this).offset().left))/2;handler.sy=((c.originalEvent.touches[0].pageY-$(this).offset().top)+(c.originalEvent.touches[1].pageY-$(this).offset().top))/2}}e=handler.sx;d=handler.sy;handler.aRadius=1;if(handler.regInfo.length>0){while(!f&&handler.regCount<handler.regInfo.length){if(((handler.regInfo[handler.regCount].sx-handler.regInfo[handler.regCount].radius)<handler.sx)&&((handler.regInfo[handler.regCount].sx+handler.regInfo[handler.regCount].radius)>handler.sx)&&((handler.regInfo[handler.regCount].sy-handler.regInfo[handler.regCount].radius)<handler.sy)&&((handler.regInfo[handler.regCount].sy+handler.regInfo[handler.regCount].radius)>handler.sy)){f=true;handler.sx=handler.regInfo[handler.regCount].sx;handler.sy=handler.regInfo[handler.regCount].sy;handler.rm=handler.regInfo[handler.regCount].cArea;handler.aRadius=handler.regInfo[handler.regCount].radius;handler.regInfo.splice(handler.regCount,1)}if(!f){handler.regCount++}}handler.regCount=0}if(c.originalEvent.touches.length===1){var k=handler.sy;b=true;$("#mAreaMobile").bind("touchmove",function(n){i.clearRect(0,0,g.width,g.height);$("#scene h5").remove();if(handler.regInfo.length>0){h.paintRegArea(g,i)}var o=n.originalEvent.touches[0].pageY-$(this).offset().top;var l=k-o;l<0?handler.aRadius+=2:handler.aRadius-=2;if(handler.aRadius<=0){handler.aRadius=1}var m=Math.PI*(handler.aRadius*handler.aRadius*handler.pixelSpacing[0]*handler.pixelSpacing[1]);handler.rm=m/handler.infoScale;$("#scene").append('<h5><span style="z-index: 20; color: #fff; background-color: rgba(0, 0, 0, 0.5); border-radius: 3px; border: 1px solid ##505050; position: absolute; top: '+(handler.sy+10)+"px; left: "+(handler.sx+10)+'px;">'+handler.rm.toFixed(0)+"[mm&sup2;]</span></h5>");i.beginPath();i.arc(handler.sx,handler.sy,handler.aRadius,0,Math.PI*2,true);i.fillStyle="rgba(213, 133, 18, 0.3)";i.fill();i.lineWidth=2;i.strokeStyle="#d58512";i.stroke();k=o})}else{if(c.originalEvent.touches.length===2&&f){$("#mAreaMobile").on("touchmove",function(l){i.clearRect(0,0,g.width,g.height);$("#scene h5").remove();if(handler.regInfo.length>0){h.paintRegArea(g,i)}a=((l.originalEvent.touches[0].pageX-$(this).offset().left)+(l.originalEvent.touches[1].pageX-$(this).offset().left))/2;j=((l.originalEvent.touches[0].pageY-$(this).offset().top)+(l.originalEvent.touches[1].pageY-$(this).offset().top))/2;handler.sx+=(a-e);handler.sy+=(j-d);$("#scene").append('<h5><span style="z-index: 20; color: #fff; background-color: rgba(0, 0, 0, 0.5); border-radius: 3px; border: 1px solid ##505050; position: absolute; top: '+(handler.sy+10)+"px; left: "+(handler.sx+10)+'px;">'+handler.rm.toFixed(0)+"[mm&sup2;]</span></h5>");i.beginPath();i.arc(handler.sx,handler.sy,handler.aRadius,0,Math.PI*2,true);i.fillStyle="rgba(213, 133, 18, 0.3)";i.fill();i.lineWidth=2;i.strokeStyle="#d58512";i.stroke();e=a;d=j})}}});$("#mAreaMobile").bind("touchend",function(){$("#mAreaMobile").unbind("touchmove");if(f||b){handler.infoData={sx:handler.sx,sy:handler.sy,radius:handler.aRadius,cArea:handler.rm};handler.regInfo.push(handler.infoData);f=false;b=false;handler.regCount=0}})}},paintRegArea:function(d,a){for(var b=0;b<handler.regInfo.length;b++){$("#scene").append('<h5><span style="z-index: 20; color: #fff; background-color: rgba(0, 0, 0, 0.5); border-radius: 3px; border: 1px solid ##505050; position: absolute; top: '+handler.regInfo[b].sy+"px; left: "+handler.regInfo[b].sx+'px;">'+handler.regInfo[b].cArea.toFixed(0)+"[mm&sup2;]</span></h5>");a.beginPath();a.arc(handler.regInfo[b].sx,handler.regInfo[b].sy,handler.regInfo[b].radius,0,Math.PI*2,true);a.fillStyle="rgba(213, 133, 18, 0.3)";a.fill();a.lineWidth=2;a.strokeStyle="#d58512";a.stroke()}}};